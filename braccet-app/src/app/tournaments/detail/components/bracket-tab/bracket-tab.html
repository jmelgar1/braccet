<div class="h-full flex flex-col">
  <!-- Header -->
  <div class="flex justify-between items-center mb-4">
    <h3 class="text-lg font-semibold text-gray-900">
      Bracket
      @if (isPreviewMode()) {
        <span class="text-sm font-normal text-gray-500 ml-2">(Preview)</span>
      }
    </h3>
  </div>

  <!-- Error message -->
  @if (bracketError()) {
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4 text-sm">
      {{ bracketError() }}
    </div>
  }

  <!-- Loading state -->
  @if (loadingBracket()) {
    <div class="flex-1 flex items-center justify-center">
      <p class="text-gray-500">Loading bracket...</p>
    </div>
  } @else {
    <!-- Bracket content -->
    <div class="flex-1 overflow-auto">
      @if (isPreviewMode()) {
        <!-- Preview mode: client-generated bracket -->
        @if (preview()) {
          <div class="mb-4 px-3 py-2 bg-yellow-50 border border-yellow-200 rounded-lg">
            <p class="text-sm text-yellow-800">
              This is a preview based on current seeding. The actual bracket will be generated when the tournament starts.
            </p>
          </div>
          <app-bracket-viewer [preview]="preview()" [isPreview]="true" />
        } @else if (participants().length < 2) {
          <div class="flex items-center justify-center h-full text-gray-500">
            <div class="text-center">
              <p class="text-lg font-medium">Not enough participants</p>
              <p class="text-sm mt-1">At least 2 participants are needed to preview the bracket.</p>
            </div>
          </div>
        } @else {
          <div class="flex items-center justify-center h-full text-gray-500">
            <p>No bracket preview available</p>
          </div>
        }
      } @else {
        <!-- Actual bracket mode -->
        @if (bracketState()) {
          <app-bracket-viewer
            [preview]="{
              totalRounds: bracketState()!.total_rounds,
              matches: bracketState()!.matches
            }"
            [isPreview]="false"
            (matchClicked)="onMatchClicked($event)"
          />
        } @else {
          <div class="flex items-center justify-center h-full text-gray-500">
            <p>No bracket available</p>
          </div>
        }
      }
    </div>
  }
</div>

<!-- Match Result Modal -->
@if (showModal() && selectedMatch()) {
  <app-match-result-modal
    [match]="selectedMatch()!"
    (close)="closeModal()"
    (resultSubmitted)="onResultSubmitted($event)"
  />
}
