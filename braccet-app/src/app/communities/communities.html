<div class="min-h-[calc(100vh-4rem)] bg-gray-100 p-6">
  <div class="w-3/4 mx-auto">
    <!-- Header -->
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-2xl font-bold text-gray-900">Communities</h1>
      <button
        (click)="toggleCreateForm()"
        class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg transition-colors">
        {{ showCreateForm() ? 'Cancel' : 'Create Community' }}
      </button>
    </div>

    <!-- Create Form -->
    @if (showCreateForm()) {
      <div class="bg-white rounded-lg shadow p-6 mb-6">
        <h2 class="text-lg font-semibold text-gray-900 mb-4">Create New Community</h2>

        @if (createError()) {
          <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
            {{ createError() }}
          </div>
        }

        <form (ngSubmit)="onCreateCommunity()" class="space-y-4">
          <div>
            <label for="name" class="block text-sm font-medium text-gray-700 mb-1">Name *</label>
            <input
              type="text"
              id="name"
              [(ngModel)]="newCommunity.name"
              name="name"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="Community name"
              [disabled]="creating()">
          </div>

          <div>
            <label for="description" class="block text-sm font-medium text-gray-700 mb-1">Description</label>
            <textarea
              id="description"
              [(ngModel)]="newCommunity.description"
              name="description"
              rows="3"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="What is this community about?"
              [disabled]="creating()"></textarea>
          </div>

          <div>
            <label for="game" class="block text-sm font-medium text-gray-700 mb-1">Game</label>
            <input
              type="text"
              id="game"
              [(ngModel)]="newCommunity.game"
              name="game"
              class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
              placeholder="e.g., Street Fighter 6, Tekken 8"
              [disabled]="creating()">
          </div>

          <div class="flex justify-end gap-3">
            <button
              type="button"
              (click)="toggleCreateForm()"
              class="px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-lg transition-colors"
              [disabled]="creating()">
              Cancel
            </button>
            <button
              type="submit"
              class="bg-blue-600 hover:bg-blue-700 text-white font-medium px-4 py-2 rounded-lg transition-colors disabled:opacity-50"
              [disabled]="creating()">
              {{ creating() ? 'Creating...' : 'Create Community' }}
            </button>
          </div>
        </form>
      </div>
    }

    <!-- Loading state -->
    @if (loading()) {
      <div class="text-center py-8">
        <p class="text-gray-500">Loading communities...</p>
      </div>
    }

    <!-- Error state -->
    @if (error()) {
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        {{ error() }}
      </div>
    }

    <!-- Community list -->
    @if (!loading() && !error()) {
      @if (communities().length === 0) {
        <div class="bg-white rounded-lg shadow p-8 text-center">
          <p class="text-gray-500 mb-4">No communities yet</p>
          <p class="text-gray-400 text-sm">Create your first community to get started</p>
        </div>
      } @else {
        <div class="space-y-4">
          @for (community of communities(); track community.id) {
            <div class="bg-white rounded-lg shadow p-4 hover:shadow-md transition-shadow cursor-pointer"
                 (click)="onCommunityClick(community.slug)">
              <div class="flex justify-between items-start">
                <div>
                  <h2 class="text-lg font-semibold text-gray-900">{{ community.name }}</h2>
                  @if (community.description) {
                    <p class="text-gray-600 text-sm mt-1">{{ community.description }}</p>
                  }
                  <div class="flex gap-4 mt-2 text-sm text-gray-500">
                    @if (community.game) {
                      <span class="px-2 py-0.5 rounded-full text-xs font-medium bg-purple-100 text-purple-700">
                        {{ community.game }}
                      </span>
                    }
                  </div>
                </div>
                <div class="flex items-center gap-3">
                  <span class="text-sm text-gray-400">
                    {{ community.created_at | date:'mediumDate' }}
                  </span>
                  <button
                    (click)="deleteCommunity(community.slug, community.name, $event)"
                    class="text-red-500 hover:text-red-700 text-sm font-medium">
                    Delete
                  </button>
                </div>
              </div>
            </div>
          }
        </div>
      }
    }
  </div>
</div>
